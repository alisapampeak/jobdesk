const operasionalLinks = [
    { name: "TO MINGGUAN TOTO", url: "https://docs.google.com/spreadsheets/d/1tmth-cI-y9087AuNieU7HowO9ZpDZlW8DmQV290bea0/edit?gid=0", desc: "Pantau turnover harian tim" },
    { name: "NEW DOMAIN TOTO", url: "https://docs.google.com/spreadsheets/d/1E9URiQr5xWfq7NWeYKaIzPa1p7ABJh-uQCg8uCdAjf4/edit?gid=1767797304", desc: "Data domain baru" },
    { name: "DATA SELISIH ADMIN", url: "https://docs.google.com/spreadsheets/d/1Y0ztHJFPsisU_Jb5nTM-tyjDwsPCkfeC7pOlf-CsTjg/edit?gid=0", desc: "Data selisih seamless dan provider" },
    { name: "NEW TUTUP BUKU", url: "https://docs.google.com/spreadsheets/d/19C29fqvNfwyM_DGof8DzMnvRFGGHyOLtXQ0R_P551HQ/edit?gid=1115223718", desc: "Data tutup buku baru" },
    { name: "PEMBAGIAN BONUS HARIAN", url: "https://docs.google.com/spreadsheets/d/1RE0z10kx4n3dh_bDXTCAdsyscVykbYJr64AO_gAvoFA/edit?gid=2126151534", desc: "Data pembagian bonus harian" },
    { name: "DATA UNTUK PROMO", url: "https://docs.google.com/spreadsheets/d/1mDH6YcvCJyPLXmWcUdrNs6gbPBNdvs2AysXTU0-uOAk/edit?gid=1493702064#gid=1493702064", desc: "Data pendapatan untuk tim promo" },
    { name: "DATA SOSIAL MEDIA", url: "https://docs.google.com/spreadsheets/d/1y3vrIK_0JVFODBKR7DJ1W5sZr8x1x_wSdGGoAD7nKFc/edit?gid=1378038835", desc: "Data sosial media toto" },
    { name: "DATA BACKUP SHORTLINK", url: "https://docs.google.com/spreadsheets/d/1-DmhqCRzRbMw2cI6uZaKdcLjJwXbgzdECpmjwLdyNuI/edit?gid=2138919053", desc: "Data backup shortlink" },
    { name: "DATA SHORTLINK TOTO", url: "https://docs.google.com/spreadsheets/d/1KoYYeSmYddrbC1ZP7802sNNDSR8DixC0d9MIBseqt8Q/edit?gid=0", desc: "Data shortlink aktif" },
    { name: "WEB PHISING", url: "https://docs.google.com/spreadsheets/d/1c2U-7iFYZCoxRIBRI77GwxRtc7n1OcdHKsgT3stZ4Vg/edit?gid=372625743", desc: "Daftar web phising" },
    { name: "FORM REPORT PHISING", url: "https://docs.google.com/forms/d/e/1FAIpQLSdZman26gLX9YbSjjePktu2mQG8iIffbUwn5naBsZKY9BnEAw/viewform", desc: "Formulir pelaporan web phising" },
    { name: "ADMIN SKYDASH TOTO", url: "https://op-games.bas3data.xyz/login", desc: "Panel admin skydash toto" },
    { name: "ADMIN SKYLINK TOTO", url: "https://skylink-v2devpaneltoto7889.totopool.net/user/login", desc: "Panel admin skylink toto" },
    { name: "GOOGLE ANALYTICS", url: "https://analytics.google.com/analytics/web/?pli=1#/p485465390/reports/intelligenthome", desc: "Laporan Google Analytics" }
];

const sosialMediaLinks = [
    { name: "Facebook", url: "https://www.facebook.com/", desc: "Platform sosial media utama" },
    { name: "Instagram", url: "https://www.instagram.com/", desc: "Berbagi foto dan video" },
    { name: "Twitter", url: "https://twitter.com/", desc: "Platform untuk update singkat dan berita" },
    { name: "YouTube", url: "https://www.youtube.com/", desc: "Tautan ke channel YouTube perusahaan" },
    { name: "Canva", url: "https://www.canva.com/", desc: "Alat desain grafis online" },
    { name: "Hootsuite", url: "https://www.hootsuite.com/", desc: "Dashboard manajemen sosial media" }
];

const prediksiPaitoLinks = [
    { name: "Totopool Login", url: "https://cdn.totopool.net/login.html", desc: "Halaman login Totopool" },
    { name: "Timer Pools", url: "http://bugilb2c.bolagila.com/timerpools.php?page=1", desc: "Tampilan timerpools" },
    { name: "Link Permata Net", url: "https://www.permatanet.com", desc: "Halaman Permata Net" },
    { name: "Spreadsheet Togel", url: "https://docs.google.com/spreadsheets/d/17Wu-031EB8fcRzAet3eHj77SPKsF7rJ4INeytTWdS74/edit?gid=0", desc: "Spreadsheet data togel" },
    { name: "Spreadsheet Prediksi", url: "https://docs.google.com/spreadsheets/d/11nrlOp3Ia8h7vLdZurAxqtwEPvS745OZpLwCGetgf5Y/edit?gid=1372472318", desc: "Spreadsheet prediksi paito" },
    { name: "Spreadsheet Angka", url: "https://docs.google.com/spreadsheets/d/1G9opEVYY-LKqnm7xvyLfwEFg2IaXPdi4o0j8WNc5X28/edit?gid=0", desc: "Spreadsheet analisis angka" }
];

const gameList = [
    { id: 14, name: "[DWT] DEWATOGEL" }, { id: 15, name: "[TOTO] BGLBOLAGILA" }, { id: 17, name: "[TOTO] DWLDEWALIVE" },
    { id: 16, name: "[TOTO] NG3NAGA303" }, { id: 74, name: "[TOTO] TG8TOGEL88" }, { id: 143, name: "[TOTO] TTLTOTOGEL" },
    { id: 223, name: "[TOTO] KTTKOINTOTO" }, { id: 225, name: "[TOTO] TT8TOTOGG88" }, { id: 189, name: "[TOTO] MG8MEGAHOKI88" },
    { id: 165, name: "[TOTO] ARSAREASLOTS" }, { id: 240, name: "[TOTO] PWNPOWERNET" }, { id: 147, name: "[TOTO] KSTKOINSLOTS" },
    { id: 263, name: "[TOTO] KJ9KINGJR99" }, { id: 243, name: "[TOTO] VT8VITOBET88" }, { id: 194, name: "[TOTO] HL8HOLYSLOT88" },
    { id: 266, name: "[TOTO] IGGINDOGG" }, { id: 258, name: "[TOTO] DGSDRAGONSLOT" }, { id: 163, name: "[TOTO] CMSCEMESLOT" },
    { id: 238, name: "[TOTO] CIDIDNARENA" }, { id: 281, name: "[TOTO] CTSCITISLOTS" }
];

const pgaVendorList = [
    { id: "20", name: "BILLING2" }, { id: "21", name: "INV1" }, { id: "22", name: "INV5" },
    { id: "23", name: "INV4" }, { id: "24", name: "TOPUP1" }, { id: "25", name: "BILLING1" },
    { id: "26", name: "BILLING4" }, { id: "27", name: "TOPUP4" }, { id: "28", name: "BILLING5" },
    { id: "29", name: "INV31" }, { id: "30", name: "BILLING31" }, { id: "34", name: "INV6" },
    { id: "35", name: "BILLING6" }, { id: "36", name: "BILLING7" }, { id: "37", name: "TOPUP5" },
    { id: "38", name: "INV7" }, { id: "13", name: "LINK2" }, { id: "17", name: "TOPUP1" },
    { id: "19", name: "TOPUP3" }, { id: "37", name: "TOPUP2" }, { id: "48", name: "TOPUP4" },
    { id: "78", name: "TOPUP5" }
];

const vendorList = [
    { id: "15", name: "TOPUP3 - 2ACQUIRE" }, { id: "16", name: "BILLING3 - 2ACQUIRE" },
    { id: "19", name: "BILLING2 - 2ACQUIRE" }, { id: "20", name: "TOPUP2 - 2ACQUIRE" },
    { id: "21", name: "INV1 - 2ACQUIRE" }, { id: "22", name: "INV5 - 2ACQUIRE" },
    { id: "23", name: "INV4 - 2ACQUIRE" }, { id: "24", name: "TOPUP1 - 2ACQUIRE" },
    { id: "25", name: "BILLING1 - 2ACQUIRE" }, { id: "26", name: "BILLING4 - 2ACQUIRE" },
    { id: "27", name: "TOPUP4 - 2ACQUIRE" }, { id: "28", name: "BILLING5 - 2ACQUIRE" },
    { id: "29", name: "INV31 - 2ACQUIRE" }, { id: "30", name: "BILLING31 - 2ACQUIRE" },
    { id: "34", name: "INV6 - 2ACQUIRE" }, { id: "35", name: "BILLING6 - 2ACQUIRE" },
    { id: "36", name: "BILLING7 - 2ACQUIRE" }, { id: "37", name: "TOPUP5 - 2ACQUIRE" },
    { id: "38", name: "INV7 - 2ACQUIRE" }
];

const pgaLbVendorList = [
    { id: "20", name: "BILLING2" },
    { id: "21", name: "INV1" },
    { id: "61", name: "BILLING31" },
    { id: "49", name: "BILLING4" },
    { id: "54", name: "BILLING5" },
    { id: "66", name: "BILLING6" },
    { id: "79", name: "BILLING7" },
    { id: "39", name: "INV1" },
    { id: "81", name: "INV3" },
    { id: "62", name: "INV31" },
    { id: "80", name: "INV4" },
    { id: "44", name: "INV5" },
    { id: "65", name: "INV6" },
    { id: "77", name: "INV7" },
    { id: "38", name: "LINK1" },
    { id: "13", name: "LINK2" },
    { id: "17", name: "TOPUP1" },
    { id: "37", name: "TOPUP2" },
    { id: "19", name: "TOPUP3" },
    { id: "48", name: "TOPUP4" },
    { id: "78", name: "TOPUP5" }
];

const paymentMethodList = [
    { value: "_Mandiri_", name: "Mandiri" }, { value: "_BNI_", name: "BNI" },
    { value: "_OVO_", name: "OVO" }, { value: "_CIMB_", name: "CIMB" },
    { value: "_BRI_", name: "BRI" }, { value: "_MAYBANK_", name: "MAYBANK" },
    { value: "_PERMATA_", name: "PERMATA" }, { value: "_DANAMON_", name: "DANAMON" },
    { value: "_INDOMARET_", name: "INDOMARET" }, { value: "_ALFAMART_", name: "ALFAMART" },
    { value: "_GOPAY_", name: "GOPAY" }, { value: "_CC_", name: "CC" },
    { value: "_BCA_", name: "BCA" }, { value: "_QRIS_", name: "QRIS" },
    { value: "_SINARMAS_", name: "SINARMAS" }, { value: "_LINKAJA_", name: "LINKAJA" },
    { value: "_SHOPEEPAY_", name: "SHOPEEPAY" }, { value: "_ATMBERSAMA_", name: "ATMBERSAMA" },
    { value: "_DANA_", name: "DANA" }, { value: "_ARTHAGRAHA_", name: "ARTHAGRAHA" },
    { value: "_SAMPOERNA_", name: "SAMPOERNA" }, { value: "_OCBCNISP_", name: "OCBCNISP" }
];

const statusList = [
    { value: "1", name: "PAID" }, { value: "2", name: "UNPAID" },
    { value: "3", name: "PENDING" }, { value: "4", name: "CANCELED" },
    { value: "5", name: "EXPIRED" }
];

const pgaLbStatusList = [
    { value: "1", name: "PAID" },
    { value: "0", name: "UNPAID" },
    { value: "2", name: "CANCELED" },
    { value: "3", name: "EXPIRED" },
    { value: "4", name: "BLOCKED" }
];

const DEPOSIT_PGA_URL = "https://dewa-dps88998.macaolloquialism.ltd/page/admin.pga-dps-history/";

function generateGameUrl(id, startDate, endDate, type) {
    if (type === 'pga') {
        return DEPOSIT_PGA_URL;
    } else if (type === 'macao') {
        return `https://dewa-dps88998.macaolloquialism.ltd/page/admin.dps-history/${id}/all/${startDate}/${endDate}/a/0/all/use_pager`;
    } else if (type === 'wd') {
        return `https://dewa-dps88998.macaolloquialism.ltd/page/admin.wd-history/${id}/all/${startDate}/${endDate}/a/0/all/use_pager`;
    }
    return '';
}

const content = {
    home: {
        title: "HOME",
        icon: "bi-house-door-fill",
        body: `
            <div class="home-content">
                <h1 class="mb-5">Selamat Bekerja!</h1>
                <div class="info-cards">
                    <div class="info-card">
                        <i class="bi bi-people-fill"></i>
                        <h4>34</h4>
                        <p>Aktif</p>
                    </div>
                    <div class="info-card">
                        <i class="bi bi-list-task"></i>
                        <h4>12</h4>
                        <p>Tugas</p>
                    </div>
                    <div class="info-card">
                        <i class="bi bi-folder-fill"></i>
                        <h4>8</h4>
                        <p>Proyek</p>
                    </div>
                    <div class="info-card">
                        <i class="bi bi-bell-fill"></i>
                        <h4>3</h4>
                        <p>Notifikasi Baru</p>
                    </div>
                </div>
            </div>
        `
    },
    operasional: {
        title: "OPERASIONAL",
        icon: "bi-gear-fill",
        body: `<p>Ini adalah konten untuk OPERASIONAL.</p>`
    },
    sosialMedia: {
        title: "SOSIAL MEDIA",
        icon: "bi-share-fill",
        body: `<p>Konten untuk manajemen sosial media ada di sini.</p>`
    },
    prediksiPaito: {
        title: "PREDIKSI PAITO",
        icon: "bi-bar-chart-line-fill",
        body: `<p>Halaman prediksi paito untuk analisa data.</p>`
    },
    depositHistory: {
        title: "DEPOSIT HISTORY",
        icon: "bi-box-arrow-in-down-right",
        body: `
            <h3 class="mb-4">üîç Filter (Buka di Macao)</h3>
            <form id="filterMacaoForm" onsubmit="return false;" class="filter-form">
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Select Game</label>
                    <div class="col-sm-8 d-flex flex-column gap-2">
                        <div class="dropdown">
                            <button class="btn btn-custom-filter dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="gameMacaoDropdown">
                                ALL
                            </button>
                            <ul class="dropdown-menu p-2" id="gameMacaoDropdownMenu" style="width: 100%;"></ul>
                        </div>
                    </div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Select Date</label>
                    <div class="col-sm-8 d-flex gap-2">
                        <input type="date" class="form-control" id="macaoStartDate" required>
                        <span class="align-self-center">to</span>
                        <input type="date" class="form-control" id="macaoEndDate" required>
                    </div>
                </div>
                <div class="text-center">
                    <button type="button" id="btn-buka-macao" class="btn btn-primary">Buka</button>
                </div>
            </form>
        `
    },
    depositPga: {
        title: "DEPOSIT PGA",
        icon: "bi-box-arrow-in-down-right",
        body: `
            <h3 class="mb-4">üîç Filter (Buka di Macao)</h3>
            <form id="filterPgaForm" onsubmit="return false;" class="filter-form">
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Select Game</label>
                    <div class="col-sm-8 d-flex flex-column gap-2">
                        <div class="dropdown">
                            <button class="btn btn-custom-filter dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="gamePgaDropdown">
                                ALL
                            </button>
                            <ul class="dropdown-menu p-2" id="gamePgaDropdownMenu" style="width: 100%;"></ul>
                        </div>
                    </div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Select Date</label>
                    <div class="col-sm-8 d-flex gap-2">
                        <input type="date" class="form-control" id="startDatePga" required>
                        <span class="align-self-center">to</span>
                        <input type="date" class="form-control" id="endDatePga" required>
                    </div>
                </div>
                <div class="mb-3 row">
                    <label for="filterName" class="col-sm-4 col-form-label">Filter Name</label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="filterName" placeholder="Search by name">
                    </div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Vendor</label>
                    <div class="col-sm-8">
                        <div class="dropdown">
                            <button class="btn btn-custom-filter dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="vendorPgaDropdown">
                                ALL
                            </button>
                            <ul class="dropdown-menu p-2" id="vendorPgaDropdownMenu" style="width: 100%;"></ul>
                        </div>
                    </div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Payment Method</label>
                    <div class="col-sm-8">
                        <div class="dropdown">
                            <button class="btn btn-custom-filter dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="paymentPgaDropdown">
                                ALL
                            </button>
                            <ul class="dropdown-menu p-2" id="paymentPgaDropdownMenu" style="width: 100%;"></ul>
                        </div>
                    </div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Filter Status</label>
                    <div class="col-sm-8">
                        <div class="dropdown">
                            <button class="btn btn-custom-filter dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="statusPgaDropdown">
                                ALL
                            </button>
                            <ul class="dropdown-menu p-2" id="statusPgaDropdownMenu" style="width: 100%;"></ul>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <button type="button" id="btn-buka-pga" class="btn btn-primary">Buka</button>
                </div>
            </form>
        `
    },
    pgaLbPanel: {
        title: "PGA LB PANEL",
        icon: "bi-clipboard-data-fill",
        body: `
            <h3 class="mb-4">üîç Filter (Buka di PGA LB)</h3>
            <form id="filterPgaLbForm" onsubmit="return false;" class="filter-form mb-4">
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Select Vendor</label>
                    <div class="col-sm-8 d-flex flex-column gap-2">
                        <div class="dropdown">
                            <button class="btn btn-custom-filter dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="pgaLbVendorDropdown">
                                ALL
                            </button>
                            <ul class="dropdown-menu p-2" id="pgaLbVendorDropdownMenu" style="width: 100%;"></ul>
                        </div>
                    </div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Select Date</label>
                    <div class="col-sm-8 d-flex gap-2">
                        <input type="date" class="form-control" id="pgaLbStartDate" required>
                        <span class="align-self-center">to</span>
                        <input type="date" class="form-control" id="pgaLbEndDate" required>
                    </div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Filter Status</label>
                    <div class="col-sm-8">
                        <div class="dropdown">
                            <button class="btn btn-custom-filter dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="pgaLbStatusDropdown">
                                ALL
                            </button>
                            <ul class="dropdown-menu p-2" id="pgaLbStatusDropdownMenu" style="width: 100%;"></ul>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <button type="button" id="btn-buka-pga-panel" class="btn btn-primary">Buka</button>
                </div>
            </form>
        `
    },
    wdHistory: {
        title: "WD HISTORY",
        icon: "bi-box-arrow-up-left",
        body: `
            <h3 class="mb-4">üîç Filter (Buka di Macao)</h3>
            <form id="filterWdForm" onsubmit="return false;" class="filter-form">
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Select Game</label>
                    <div class="col-sm-8 d-flex flex-column gap-2">
                        <div class="dropdown">
                            <button class="btn btn-custom-filter dropdown-toggle w-100 text-start" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="gameWdDropdown">
                                ALL
                            </button>
                            <ul class="dropdown-menu p-2" id="gameWdDropdownMenu" style="width: 100%;"></ul>
                        </div>
                    </div>
                </div>
                <div class="mb-3 row">
                    <label class="col-sm-4 col-form-label">Select Date</label>
                    <div class="col-sm-8 d-flex gap-2">
                        <input type="date" class="form-control" id="wdStartDate" required>
                        <span class="align-self-center">to</span>
                        <input type="date" class="form-control" id="wdEndDate" required>
                    </div>
                </div>
                <div class="text-center">
                    <button type="button" id="btn-buka-wd-game" class="btn btn-primary">Buka</button>
                </div>
            </form>
        `
    }
};

const mainContent = document.getElementById('main-content');
const pageTitle = document.getElementById('page-title');
const pageIcon = document.getElementById('page-icon');
const currentDatetimeEl = document.getElementById('current-datetime');
const menuItems = document.querySelectorAll('#menu .nav-link');
const darkModeToggle = document.getElementById('darkModeToggle');
const sidebar = document.getElementById('sidebar');
const main = document.querySelector('main');
const hamburgerMenu = document.getElementById('hamburgerMenu');

function updateHeaderDateTime() {
    const now = new Date();
    const timeOptions = { hour: '2-digit', minute: '2-digit', hour12: false };
    const dateOptions = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };

    const timeStr = now.toLocaleTimeString('id-ID', timeOptions);
    const dateStr = now.toLocaleDateString('id-ID', dateOptions);

    const offset = now.getTimezoneOffset() / 60 * -1;
    const gmtStr = `GMT ${offset > 0 ? '+' : ''}${offset}`;

    currentDatetimeEl.textContent = `${dateStr} Pukul ${timeStr} ${gmtStr}`;
}

function populateDropdown(dropdownMenuId, options) {
    const menu = document.getElementById(dropdownMenuId);
    if (!menu) return;
    menu.innerHTML = '';

    const searchInput = document.createElement('input');
    searchInput.type = 'text';
    searchInput.className = 'form-control mb-2';
    searchInput.placeholder = 'Search...';
    searchInput.onclick = (e) => e.stopPropagation();
    menu.appendChild(searchInput);

    const selectAllItem = document.createElement('li');
    selectAllItem.className = 'dropdown-item';
    selectAllItem.onclick = (e) => e.stopPropagation();
    const selectAllCheckbox = document.createElement('input');
    selectAllCheckbox.type = 'checkbox';
    selectAllCheckbox.id = `selectAll-${dropdownMenuId}`;
    selectAllCheckbox.className = 'form-check-input me-2';
    const selectAllLabel = document.createElement('label');
    selectAllLabel.className = 'form-check-label';
    selectAllLabel.htmlFor = selectAllCheckbox.id;
    selectAllLabel.textContent = 'Select All';
    selectAllItem.appendChild(selectAllCheckbox);
    selectAllItem.appendChild(selectAllLabel);
    menu.appendChild(selectAllItem);

    const optionContainer = document.createElement('div');
    menu.appendChild(optionContainer);

    options.forEach(option => {
        const item = document.createElement('li');
        item.className = 'dropdown-item d-flex align-items-center';
        item.onclick = (e) => e.stopPropagation();
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = option.id || option.value;
        checkbox.id = `${dropdownMenuId}-${option.id || option.value}`;
        checkbox.className = 'form-check-input me-2';
        const label = document.createElement('label');
        label.className = 'form-check-label';
        label.htmlFor = checkbox.id;
        label.textContent = option.name;
        item.appendChild(checkbox);
        item.appendChild(label);
        optionContainer.appendChild(item);
    });

    const optionItems = optionContainer.querySelectorAll('.dropdown-item');

    searchInput.addEventListener('input', (e) => {
        const searchValue = e.target.value.toLowerCase();
        optionItems.forEach(item => {
            const labelText = item.querySelector('label').textContent.toLowerCase();
            if (labelText.includes(searchValue)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    });

    selectAllCheckbox.addEventListener('change', () => {
        const visibleCheckboxes = Array.from(optionItems).filter(item => item.style.display !== 'none').map(item => item.querySelector('input[type="checkbox"]'));
        const isAllSelected = visibleCheckboxes.every(cb => cb.checked);
        visibleCheckboxes.forEach(cb => {
            cb.checked = !isAllSelected;
        });
        updateDropdownButtonText(dropdownMenuId);
    });

    optionItems.forEach(item => {
        const checkbox = item.querySelector('input[type="checkbox"]');
        checkbox.addEventListener('change', () => {
            const visibleCheckboxes = Array.from(optionItems).filter(item => item.style.display !== 'none').map(item => item.querySelector('input[type="checkbox"]'));
            const isAllSelected = visibleCheckboxes.length > 0 && visibleCheckboxes.every(cb => cb.checked);
            selectAllCheckbox.checked = isAllSelected;
            updateDropdownButtonText(dropdownMenuId);
        });
    });

    const initialCheckboxes = menu.querySelectorAll('.dropdown-item input[type="checkbox"]:not(#selectAll-' + dropdownMenuId + ')');
    initialCheckboxes.forEach(cb => cb.checked = true);
    selectAllCheckbox.checked = true;
    updateDropdownButtonText(dropdownMenuId);
}

function updateDropdownButtonText(dropdownMenuId) {
    const button = document.getElementById(dropdownMenuId.replace('Menu', ''));
    const checkboxes = document.querySelectorAll(`#${dropdownMenuId} .dropdown-item input[type="checkbox"]:not(#selectAll-${dropdownMenuId})`);
    const checkedCheckboxes = Array.from(checkboxes).filter(cb => cb.checked);

    if (checkedCheckboxes.length === checkboxes.length) {
        button.textContent = 'ALL';
    } else if (checkedCheckboxes.length === 0) {
        button.textContent = 'None Selected';
    } else if (checkedCheckboxes.length === 1) {
        button.textContent = checkedCheckboxes[0].nextElementSibling.textContent;
    } else {
        button.textContent = `${checkedCheckboxes.length} Selected`;
    }
}

function getSelectedValues(dropdownMenuId) {
    const checkboxes = document.querySelectorAll(`#${dropdownMenuId} .dropdown-item input[type="checkbox"]:not(#selectAll-${dropdownMenuId})`);
    const checkedCheckboxes = Array.from(checkboxes).filter(cb => cb.checked);

    if (checkedCheckboxes.length === checkboxes.length) {
        return Array.from(checkboxes).map(cb => cb.value);
    }

    return checkedCheckboxes.map(cb => cb.value);
}

function getAllValues(dropdownMenuId) {
    const checkboxes = document.querySelectorAll(`#${dropdownMenuId} .dropdown-item input[type="checkbox"]:not(#selectAll-${dropdownMenuId})`);
    return Array.from(checkboxes).map(cb => cb.value);
}

function setDefaultDropdownSelection(dropdownMenuId, valueToSelect) {
    const menu = document.getElementById(dropdownMenuId);
    if (!menu) return;

    const checkboxes = menu.querySelectorAll('.dropdown-item input[type="checkbox"]');

    checkboxes.forEach(cb => cb.checked = false);

    const targetCheckbox = menu.querySelector(`input[value="${valueToSelect}"]`);
    if (targetCheckbox) {
        targetCheckbox.checked = true;
    }

    const selectAllCheckbox = document.getElementById(`selectAll-${dropdownMenuId}`);
    if (selectAllCheckbox) {
        selectAllCheckbox.checked = false;
    }

    updateDropdownButtonText(dropdownMenuId);
}

function getTodayGMT7() {
    const now = new Date();
    const options = {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        timeZone: 'Asia/Jakarta'
    };
    const formatter = new Intl.DateTimeFormat('en-CA', options);
    return formatter.format(now);
}
const today = getTodayGMT7();

function renderContent(key) {
    if (!content[key]) {
        mainContent.innerHTML = '<p>Content not found</p>';
        return;
    }

    pageTitle.innerHTML = `<i class="${content[key].icon}"></i>${content[key].title}`;
    mainContent.innerHTML = content[key].body;

    if (key === 'operasional') {
        const btnBukaSemua = document.createElement('div');
        btnBukaSemua.className = 'text-left my-4';
        btnBukaSemua.innerHTML = `<button id="btn-buka-semua" class="btn btn-lg btn-success">Buka Semua Operasional</button>`;
        mainContent.appendChild(btnBukaSemua);

        const cardContainer = document.createElement('div');
        cardContainer.className = 'row row-cols-1 row-cols-md-2 g-4';
        operasionalLinks.forEach(link => {
            cardContainer.innerHTML += `
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">${link.name}</h5>
                            <p class="card-text">${link.desc}</p>
                            <a href="${link.url}" target="_blank" class="btn btn-primary mt-2">Buka</a>
                        </div>
                    </div>
                </div>
            `;
        });
        mainContent.appendChild(cardContainer);

        document.getElementById('btn-buka-semua').onclick = () => {
            operasionalLinks.forEach(link => window.open(link.url, '_blank'));
        };
    } else if (key === 'sosialMedia') {
        const btnBukaSemua = document.createElement('div');
        btnBukaSemua.className = 'text-left my-4';
        btnBukaSemua.innerHTML = `<button id="btn-buka-semua" class="btn btn-lg btn-success">Buka Semua Sosial Media</button>`;
        mainContent.appendChild(btnBukaSemua);

        const cardContainer = document.createElement('div');
        cardContainer.className = 'row row-cols-1 row-cols-md-2 g-4';
        sosialMediaLinks.forEach(link => {
            cardContainer.innerHTML += `
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">${link.name}</h5>
                            <p class="card-text">${link.desc}</p>
                            <a href="${link.url}" target="_blank" class="btn btn-info mt-2">Buka</a>
                        </div>
                    </div>
                </div>
            `;
        });
        mainContent.appendChild(cardContainer);

        document.getElementById('btn-buka-semua').onclick = () => {
            sosialMediaLinks.forEach(link => window.open(link.url, '_blank'));
        };
    } else if (key === 'prediksiPaito') {
        const btnBukaSemua = document.createElement('div');
        btnBukaSemua.className = 'text-left my-4';
        btnBukaSemua.innerHTML = `<button id="btn-buka-semua" class="btn btn-lg btn-success">Buka Semua Prediksi Paito</button>`;
        mainContent.appendChild(btnBukaSemua);

        const cardContainer = document.createElement('div');
        cardContainer.className = 'row row-cols-1 row-cols-md-2 g-4';
        prediksiPaitoLinks.forEach(link => {
            cardContainer.innerHTML += `
                <div class="col">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">${link.name}</h5>
                            <p class="card-text">${link.desc}</p>
                            <a href="${link.url}" target="_blank" class="btn btn-warning mt-2">Buka</a>
                        </div>
                    </div>
                </div>
            `;
        });
        mainContent.appendChild(cardContainer);

        document.getElementById('btn-buka-semua').onclick = () => {
            prediksiPaitoLinks.forEach(link => window.open(link.url, '_blank'));
        };
    } else if (key === 'depositHistory') {
        populateDropdown('gameMacaoDropdownMenu', gameList);

        const startDateInput = document.getElementById('macaoStartDate');
        const endDateInput = document.getElementById('macaoEndDate');
        if (startDateInput && endDateInput) {
            startDateInput.value = today;
            endDateInput.value = today;
        }

        const btn = document.getElementById('btn-buka-macao');
        btn.onclick = () => {
            const selectedGames = getSelectedValues('gameMacaoDropdownMenu');
            if (selectedGames.length === 0) {
                alert('Pilih setidaknya satu game!');
                return;
            }
            const startDateRaw = startDateInput.value;
            const endDateRaw = endDateInput.value;
            if (!startDateRaw || !endDateRaw) {
                alert('Tanggal harus diisi!');
                return;
            }
            const startDate = startDateRaw.replace(/-/g, '');
            const endDate = endDateRaw.replace(/-/g, '');
            selectedGames.forEach(gameId => {
                const url = generateGameUrl(gameId, startDate, endDate, 'macao');
                window.open(url, '_blank');
            });
        };
    } else if (key === 'depositPga') {
        populateDropdown('gamePgaDropdownMenu', gameList);
        populateDropdown('vendorPgaDropdownMenu', pgaVendorList);
        populateDropdown('paymentPgaDropdownMenu', paymentMethodList);
        populateDropdown('statusPgaDropdownMenu', statusList);

        const startDateInput = document.getElementById('startDatePga');
        const endDateInput = document.getElementById('endDatePga');
        if (startDateInput && endDateInput) {
            startDateInput.value = today;
            endDateInput.value = today;
        }

        const btn = document.getElementById('btn-buka-pga');
        btn.onclick = () => {
            const selectedGames = getSelectedValues('gamePgaDropdownMenu');
            const selectedVendors = getSelectedValues('vendorPgaDropdownMenu');
            const selectedPayments = getSelectedValues('paymentPgaDropdownMenu');
            const selectedStatus = getSelectedValues('statusPgaDropdownMenu');

            if (selectedGames.length === 0) {
                alert('Pilih setidaknya satu game!');
                return;
            }

            selectedGames.forEach(() => {
                window.open(DEPOSIT_PGA_URL, '_blank');
            });
        };
    } else if (key === 'pgaLbPanel') {
        populateDropdown('pgaLbVendorDropdownMenu', pgaLbVendorList);
        populateDropdown('pgaLbStatusDropdownMenu', pgaLbStatusList);

        setDefaultDropdownSelection('pgaLbStatusDropdownMenu', '1');

        const pgaLbStartDateInput = document.getElementById('pgaLbStartDate');
        const pgaLbEndDateInput = document.getElementById('pgaLbEndDate');
        if (pgaLbStartDateInput && pgaLbEndDateInput) {
            pgaLbStartDateInput.value = today;
            pgaLbEndDateInput.value = today;
        }

        const btn = document.getElementById('btn-buka-pga-panel');
        btn.onclick = () => {
            const startDateRaw = pgaLbStartDateInput.value;
            const endDateRaw = pgaLbEndDateInput.value;
            if (!startDateRaw || !endDateRaw) {
                alert('Tanggal harus diisi!');
                return;
            }
            const selectedVendors = getSelectedValues('pgaLbVendorDropdownMenu');
            const selectedStatuses = getSelectedValues('pgaLbStatusDropdownMenu');
            const allStatuses = getAllValues('pgaLbStatusDropdownMenu');
            const allVendors = getAllValues('pgaLbVendorDropdownMenu');

            if (selectedVendors.length === 0) {
                alert('Pilih setidaknya satu vendor!');
                return;
            }

            const startDate = startDateRaw.replace(/-/g, '');
            const endDate = endDateRaw.replace(/-/g, '');

            const vendorParams = selectedVendors.map(vendorId => `pga%5B%5D=${vendorId}`).join('&');

            let statusParams = '';
            if (selectedStatuses && selectedStatuses.length > 0) {
                statusParams = selectedStatuses.map(status => `paid_status%5B%5D=${status}`).join('&');
            } else if (!selectedStatuses || selectedStatuses.length === 0) {
                statusParams = allStatuses.map(status => `paid_status%5B%5D=${status}`).join('&');
            } else {
                statusParams = selectedStatuses.map(status => `paid_status%5B%5D=${status}`).join('&');
            }

            const url = `https://dashboard.q2checkout.com/panel/transaction?start_date=${startDate}&end_date=${endDate}&date_filter_type=1&${vendorParams}&${statusParams}`;
            window.open(url, '_blank');
        };
    } else if (key === 'wdHistory') {
        populateDropdown('gameWdDropdownMenu', gameList);

        const wdStartDateInput = document.getElementById('wdStartDate');
        const wdEndDateInput = document.getElementById('wdEndDate');
        if (wdStartDateInput && wdEndDateInput) {
            wdStartDateInput.value = today;
            wdEndDateInput.value = today;
        }

        const btn = document.getElementById('btn-buka-wd-game');
        btn.onclick = () => {
            const selectedGames = getSelectedValues('gameWdDropdownMenu');
            if (selectedGames.length === 0) {
                alert('Pilih setidaknya satu game!');
                return;
            }
            const startDateRaw = wdStartDateInput.value;
            const endDateRaw = wdEndDateInput.value;
            if (!startDateRaw || !endDateRaw) {
                alert('Tanggal harus diisi!');
                return;
            }
            const startDate = startDateRaw.replace(/-/g, '');
            const endDate = endDateRaw.replace(/-/g, '');
            selectedGames.forEach(gameId => {
                const url = generateGameUrl(gameId, startDate, endDate, 'wd');
                window.open(url, '_blank');
            });
        };
    }
}

darkModeToggle.addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
    const isDarkMode = document.body.classList.contains('dark-mode');
    localStorage.setItem('darkMode', isDarkMode);
    const toggleText = darkModeToggle.querySelector('span');
    const toggleIcon = darkModeToggle.querySelector('i');
    if (isDarkMode) {
        toggleText.textContent = 'Mode Terang';
        toggleIcon.className = 'bi bi-sun-fill';
    } else {
        toggleText.textContent = 'Mode Gelap';
        toggleIcon.className = 'bi bi-moon-fill';
    }
});

function checkDarkMode() {
    const isDarkMode = localStorage.getItem('darkMode') === 'true';
    if (isDarkMode) {
        document.body.classList.add('dark-mode');
        const toggleText = darkModeToggle.querySelector('span');
        const toggleIcon = darkModeToggle.querySelector('i');
        toggleText.textContent = 'Mode Terang';
        toggleIcon.className = 'bi bi-sun-fill';
    }
}

hamburgerMenu.addEventListener('click', () => {
    sidebar.classList.toggle('active');
    main.classList.toggle('active');
});

menuItems.forEach(item => {
    item.addEventListener('click', () => {
        menuItems.forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        const key = item.getAttribute('data-key');
        renderContent(key);

        if (window.innerWidth <= 992) {
            sidebar.classList.remove('active');
            main.classList.remove('active');
        }
    });
});

checkDarkMode();
renderContent('home');
setInterval(updateHeaderDateTime, 1000);
updateHeaderDateTime();